generator client {  
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"  
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Area {
  id                     String                @id @default(uuid())
  nombre                 String                @unique
  createdAt              DateTime              @default(now()) @map("created_at")
  updatedAt              DateTime              @updatedAt @map("updated_at")
  descripcionCorta       String?
  descripcionLarga       String?
  imagen                 String?
  competencias           Competencia[]
  contenidosCurriculares ContenidoCurricular[]
  nivelesDesempeno       NivelDesempeno[]
  simulacros             Simulacro[]

  @@map("areas")
}

model ContenidoCurricular {
  id               String        @id @default(uuid())
  nombre           String
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?

  ejesTematicos    EjeTematico[]

  area             Area          @relation(fields: [areaId], references: [id], onDelete: Cascade)
  areaId           String        @map("area_id")

  @@index([areaId])
  @@map("contenidos_curriculares")
}

model EjeTematico {
  id                    String                @id @default(uuid())
  nombre                String
  descripcionCorta      String?
  descripcionLarga      String?
  imagen                String?
  orden                 Int?
  preguntaTematica      String?
  relevanciaICFES       String?
  video                 String?

  contenidoCurricular   ContenidoCurricular   @relation(fields: [contenidoCurricularId], references: [id], onDelete: Cascade)
  contenidoCurricularId String                @map("contenido_curricular_id")

  objetivosAprendizaje  ObjetivoAprendizaje[]
  secciones             Seccion[]
  preguntas             Pregunta[]            @relation("EjeTematicoPreguntas")

  @@unique([contenidoCurricularId, nombre])
  @@index([contenidoCurricularId])
  @@map("ejes_tematicos")
}

model Seccion {
  id            String                 @id @default(uuid())
  nombre        String
  descripcion   String?
  tipo          TipoSeccion
  createdAt     DateTime               @default(now()) @map("created_at")
  updatedAt     DateTime               @updatedAt @map("updated_at")
  
  ejeTematico   EjeTematico            @relation(fields: [ejeTematicoId], references: [id], onDelete: Cascade)
  ejeTematicoId String                 @map("eje_tematico_id")

  actividades   ActividadInteractiva[]
  progresos     ProgresoSeccion[]
  subTemas      SubTema[]

  @@index([ejeTematicoId])
  @@map("secciones")
}

model SubTema {
  id          String            @id @default(uuid())
  nombre      String
  descripcion String
  imagen      String?
  video       String?
  createdAt   DateTime          @default(now()) @map("created_at")
  seccionId   String            @map("seccion_id")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  ejemplo     String?
  progresos   ProgresoSubTema[]
  seccion     Seccion           @relation(fields: [seccionId], references: [id], onDelete: Cascade)

  @@index([seccionId])
  @@map("sub_temas")
}

model ActividadInteractiva {
  id                String                   @id @default(uuid())
  nombre            String
  tipo              TipoActividadInteractiva
  imagen            String?
  createdAt         DateTime                 @default(now()) @map("created_at")
  updatedAt         DateTime                 @updatedAt @map("updated_at")
  match             String
  retroalimentacion String

  seccion           Seccion                  @relation(fields: [seccionId], references: [id], onDelete: Cascade)
  seccionId         String                   @map("seccion_id")
  
  progresos         ProgresoActividad[] 

  @@index([seccionId])
  @@map("actividades_interactivas")
}

model ObjetivoAprendizaje {
  id            String      @id @default(uuid())
  descripcion   String
  ejeTematicoId String      @map("eje_tematico_id")
  ejeTematico   EjeTematico @relation(fields: [ejeTematicoId], references: [id], onDelete: Cascade)

  @@index([ejeTematicoId])
  @@map("objetivos_aprendizaje")
}

model NivelDesempeno {
  id          String   @id @default(uuid())
  descripcion String
  puntajeMin  Int
  puntajeMax  Int
  nivel       Nivel
  areaId      String   @map("area_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  area        Area     @relation(fields: [areaId], references: [id], onDelete: Cascade)

  @@index([areaId])
  @@map("niveles_desempeno")
}

model ProgresoSeccion {
  id         String  @id @default(uuid())
  avance     Float   @default(0)
  completada Boolean

  seccion   Seccion @relation(fields: [seccionId], references: [id], onDelete: Cascade)
  seccionId String  @map("seccion_id")

  usuario   User   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  usuarioId String @map("usuario_id")

  @@unique([usuarioId, seccionId])
  @@index([usuarioId])
  @@index([seccionId])
  @@map("progresos_seccion")
}

model ProgresoSubTema {
  id         String  @id @default(uuid())
  completado Boolean
  usuarioId  String  @map("usuario_id")
  subTemaId  String  @map("sub_tema_id")
  subTema    SubTema @relation(fields: [subTemaId], references: [id], onDelete: Cascade)
  usuario    User    @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, subTemaId])
  @@index([usuarioId])
  @@index([subTemaId])
  @@map("progresos_sub_tema")
}

model ProgresoActividad {
  id          String               @id @default(uuid())
  completado  Boolean
  intentos    Int
  usuarioId   String               @map("usuario_id")
  actividadId String               @map("actividad_id")
  actividad   ActividadInteractiva @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  usuario     User                 @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, actividadId])
  @@index([usuarioId])
  @@index([actividadId])
  @@map("progresos_actividad")
}

model Competencia {
  id               String       @id @default(uuid())
  nombre           String
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  areaId           String       @map("area_id")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?
  afirmaciones     Afirmacion[]
  area             Area         @relation(fields: [areaId], references: [id], onDelete: Cascade)
  simulacros       Simulacro[]

  @@unique([areaId, nombre])
  @@index([areaId])
  @@map("competencias")
}

model Afirmacion {
  id               String      @id @default(uuid())
  nombre           String
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")
  competenciaId    String      @map("competencia_id")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?
  competencia      Competencia @relation(fields: [competenciaId], references: [id], onDelete: Cascade)
  evidencias       Evidencia[]

  @@unique([competenciaId, nombre])
  @@index([competenciaId])
  @@map("afirmaciones")
}

model Evidencia {
  id               String     @id @default(uuid())
  nombre           String
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  afirmacionId     String     @map("afirmacion_id")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?
  afirmacion       Afirmacion @relation(fields: [afirmacionId], references: [id], onDelete: Cascade)
  preguntas        Pregunta[]

  @@unique([afirmacionId, nombre])
  @@index([afirmacionId])
  @@map("evidencias")
}

model Pregunta {
  id                 String              @id @default(uuid())
  contexto           String
  imagen             String?
  enunciado          String
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  groupFlag          String?
  
  evidencia          Evidencia           @relation(fields: [evidenciaId], references: [id])
  evidenciaId        String              @map("evidencia_id")

  simulacroPreguntas SimulacroPregunta[]
  ejesTematicos      EjeTematico[]       @relation("EjeTematicoPreguntas")
  opciones           OpcionPregunta[]

  @@index([evidenciaId])
  @@map("preguntas")
}

model OpcionPregunta {
  id                  String              @id @default(uuid())
  respuesta           String
  correcta            Boolean
  retroalimentacion   String?
  preguntaId          String              @map("pregunta_id")
  pregunta            Pregunta            @relation(fields: [preguntaId], references: [id], onDelete: Cascade)
  respuestasSimulacro SimulacroPregunta[]

  @@index([preguntaId])
  @@map("opciones_pregunta")
}

model Simulacro {
  id              String              @id @default(uuid())
  score           Float?
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  duracionMinutos Int?
  
  competencia     Competencia?         @relation(fields: [competenciaId], references: [id])
  competenciaId   String?              @map("competencia_id")

  area            Area?               @relation(fields: [areaId], references: [id])
  areaId          String?             @map("area_id")
  
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String              @map("user_id")
  
  preguntas       SimulacroPregunta[]

  @@index([userId])
  @@index([competenciaId])
  @@index([areaId])
  @@map("simulacros")
}

model SimulacroPregunta {
  id                   String          @id @default(uuid())
  simulacroId          String          @map("simulacro_id")
  preguntaId           String          @map("pregunta_id")
  opcionSeleccionadaId String?         @map("opcion_seleccionada_id")
  correcta             Boolean?
  opcionSeleccionada   OpcionPregunta? @relation(fields: [opcionSeleccionadaId], references: [id])
  pregunta             Pregunta        @relation(fields: [preguntaId], references: [id])
  simulacro            Simulacro       @relation(fields: [simulacroId], references: [id], onDelete: Cascade)

  @@unique([simulacroId, preguntaId])
  @@index([simulacroId])
  @@index([preguntaId])
  @@index([opcionSeleccionadaId])
  @@map("simulacro_preguntas")
}

model User {
  id                    String                 @id @default(uuid())
  email                 String                 @unique
  password              String?
  name                  String
  lastName              String?
  image                 String?
  phone                 String?
  role                  Role                   @default(USER)
  isActive              Boolean                @default(false) @map("is_active")
  activationDate        DateTime?              @map("activation_date")
  idDocument            String?
  address               String?
  city                  String?
  department            String?
  degree                String?
  lastLogin             DateTime?              @map("last_login")
  emailVerified         DateTime?

  accounts              Account[]
  progresosActividad    ProgresoActividad[]
  progresosSeccion      ProgresoSeccion[]
  progresosSubTema      ProgresoSubTema[]
  sessions              Session[]
  simulacros            Simulacro[]
  testimonios           Testimonio[]
  twoFactorConfirmation TwoFactorConfirmation?
  order                 Order[]
  freeSimulacrosCount   Int                    @default(0) @map("free_simulacros_count")

  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")

  school   School? @relation(fields: [schoolId], references: [id])
  schoolId String? @map("school_id")

  schoolSede   SchoolSede? @relation(fields: [schoolSedeId], references: [id])
  schoolSedeId String?     @map("school_sede_id")

  @@index([schoolId])
  @@index([schoolSedeId])
  @@map("users")
}

model VerificationToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("verification_tokens")
}

model PasswordResetToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("password_reset_tokens")
}

model TwoFactorToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("two_factor_tokens")
}

model TwoFactorConfirmation {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("two_factor_confirmations")
}

model Account {
  id                String  @id @default(uuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique @map("session_token")
  expires      DateTime

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @map("user_id")

  @@map("sessions")
}

model School {
  id         String       @id @default(uuid())
  nombre     String
  email      String?      @unique
  DANE       String       @unique
  address    String?
  department String?
  city       String?
  maxUsers   Int?
  sedes      SchoolSede[]
  users      User[]

  @@map("schools")
}

model SchoolSede {
  id     String @id @default(uuid())
  nombre String
  DANE   String @unique

  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  schoolId String @map("school_id")

  users User[]

  @@index([schoolId])
  @@map("school_sedes")
}

model Testimonio {
  id         String   @id @default(uuid())
  rating     Int
  comentario String
  publicado  Boolean  @default(false)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @map("user_id")

  @@index([userId])
  @@map("testimonios")
}

model Product {
  id              String                  @id @default(uuid())
  name            String                  @unique
  price           Float
  durationInDays  Int                     @default(365)
  description     String?
  isActive        Boolean                 @default(true)
  orders          Order[]
  characteristics ProductCharacteristic[]

  @@map("products")
}

model ProductCharacteristic {
  id   String @id @default(uuid())
  name String

  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String  @map("product_id")

  @@index([productId])
  @@map("product_characteristics")
}

model Order {
  id             String      @id @default(uuid())
  status         OrderStatus @default(PENDING)
  totalAmount    Float
  payment        Payment?
  paymentMethod  String?
  referenciaPago String?
  schoolName     String?
  daneCode       String?

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId])
  @@map("orders")
}

model Payment {
  id                   String        @id @default(uuid())
  amount               Float
  status               PaymentStatus
  mercadoPagoPaymentId String?       @unique @map("mercado_pago_payment_id")
  createdAt            DateTime      @default(now())

  order   Order  @relation(fields: [orderId], references: [id])
  orderId String @unique

  @@map("payments")
}

enum TipoSeccion {
  TEORIA
  INTERACTIVA
}

enum TipoActividadInteractiva {
  RELACIONAR
  IDENTIFICAR
  GRAFICO
}

enum Role {
  ADMIN
  ADMINSCHOOL
  USER
  DOCENTE
}

enum OrderStatus {
  PENDING
  COMPLETED
  FAILED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum Nivel {
  NIVEL1
  NIVEL2
  NIVEL3
  NIVEL4
}
