generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Area {
  id                     String                @id @default(uuid())
  nombre                 String                @unique
  createdAt              DateTime              @default(now()) @map("created_at")
  updatedAt              DateTime              @updatedAt @map("updated_at")
  descripcionCorta       String?
  descripcionLarga       String?
  imagen                 String?
  competencias           Competencia[]
  contenidosCurriculares ContenidoCurricular[]
  nivelesDesempeno       NivelDesempeno[]

  @@map("areas")
}

model ContenidoCurricular {
  id               String        @id @default(uuid())
  nombre           String
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  areaId           String        @map("area_id")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?
  area             Area          @relation(fields: [areaId], references: [id], onDelete: Cascade)
  ejesTematicos    EjeTematico[]

  @@index([areaId])
  @@map("contenidos_curriculares")
}

model EjeTematico {
  id                    String                @id @default(uuid())
  nombre                String
  contenidoCurricularId String                @map("contenido_curricular_id")
  descripcionCorta      String?
  descripcionLarga      String?
  imagen                String?
  orden                 Int?
  preguntaTematica      String?
  relevanciaICFES       String?
  video                 String?
  contenidoCurricular   ContenidoCurricular   @relation(fields: [contenidoCurricularId], references: [id], onDelete: Cascade)
  objetivosAprendizaje  ObjetivoAprendizaje[]
  secciones             Seccion[]
  preguntas             Pregunta[]            @relation("EjeTematicoPreguntas")

  @@unique([contenidoCurricularId, nombre])
  @@index([contenidoCurricularId])
  @@map("ejes_tematicos")
}

model Seccion {
  id            String                 @id @default(uuid())
  nombre        String
  descripcion   String?
  tipo          TipoSeccion
  createdAt     DateTime               @default(now()) @map("created_at")
  updatedAt     DateTime               @updatedAt @map("updated_at")
  ejeTematicoId String                 @map("eje_tematico_id")
  actividades   ActividadInteractiva[]
  progresos     ProgresoSeccion[]
  ejeTematico   EjeTematico            @relation(fields: [ejeTematicoId], references: [id], onDelete: Cascade)
  subTemas      SubTema[]

  @@index([ejeTematicoId])
  @@map("secciones")
}

model SubTema {
  id          String            @id @default(uuid())
  nombre      String
  descripcion String
  imagen      String?
  video       String?
  createdAt   DateTime          @default(now()) @map("created_at")
  seccionId   String            @map("seccion_id")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  ejemplo     String?
  progresos   ProgresoSubTema[]
  seccion     Seccion           @relation(fields: [seccionId], references: [id], onDelete: Cascade)

  @@index([seccionId])
  @@map("sub_temas")
}

model ActividadInteractiva {
  id                String                   @id @default(uuid())
  nombre            String
  tipo              TipoActividadInteractiva
  imagen            String?
  createdAt         DateTime                 @default(now()) @map("created_at")
  updatedAt         DateTime                 @updatedAt @map("updated_at")
  match             String
  retroalimentacion String
  seccionId         String                   @map("seccion_id")
  seccion           Seccion                  @relation(fields: [seccionId], references: [id], onDelete: Cascade)
  progresos         ProgresoActividad[]

  @@index([seccionId])
  @@map("actividades_interactivas")
}

model ObjetivoAprendizaje {
  id            String      @id @default(uuid())
  descripcion   String
  ejeTematicoId String      @map("eje_tematico_id")
  ejeTematico   EjeTematico @relation(fields: [ejeTematicoId], references: [id], onDelete: Cascade)

  @@index([ejeTematicoId])
  @@map("objetivos_aprendizaje")
}

model NivelDesempeno {
  id          String   @id @default(uuid())
  descripcion String
  puntajeMin  Int
  puntajeMax  Int
  nivel       Nivel
  areaId      String   @map("area_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  area        Area     @relation(fields: [areaId], references: [id], onDelete: Cascade)

  @@index([areaId])
  @@map("niveles_desempeno")
}

model ProgresoSeccion {
  id         String  @id @default(uuid())
  avance     Float   @default(0)
  completada Boolean
  
  seccion    Seccion @relation(fields: [seccionId], references: [id], onDelete: Cascade)
  seccionId  String  @map("seccion_id")

  usuario    User    @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  usuarioId  String  @map("usuario_id")

  @@unique([usuarioId, seccionId])
  @@index([usuarioId])
  @@index([seccionId])
  @@map("progresos_seccion")
}

model ProgresoSubTema {
  id         String  @id @default(uuid())
  completado Boolean
  usuarioId  String  @map("usuario_id")
  subTemaId  String  @map("sub_tema_id")
  subTema    SubTema @relation(fields: [subTemaId], references: [id], onDelete: Cascade)
  usuario    User    @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, subTemaId])
  @@index([usuarioId])
  @@index([subTemaId])
  @@map("progresos_sub_tema")
}

model ProgresoActividad {
  id          String               @id @default(uuid())
  completado  Boolean
  intentos    Int
  usuarioId   String               @map("usuario_id")
  actividadId String               @map("actividad_id")
  actividad   ActividadInteractiva @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  usuario     User                 @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, actividadId])
  @@index([usuarioId])
  @@index([actividadId])
  @@map("progresos_actividad")
}

model Competencia {
  id               String       @id @default(uuid())
  nombre           String
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  areaId           String       @map("area_id")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?
  afirmaciones     Afirmacion[]
  area             Area         @relation(fields: [areaId], references: [id], onDelete: Cascade)
  simulacros       Simulacro[]

  @@unique([areaId, nombre])
  @@index([areaId])
  @@map("competencias")
}

model Afirmacion {
  id               String      @id @default(uuid())
  nombre           String
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")
  competenciaId    String      @map("competencia_id")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?
  competencia      Competencia @relation(fields: [competenciaId], references: [id], onDelete: Cascade)
  evidencias       Evidencia[]

  @@unique([competenciaId, nombre])
  @@index([competenciaId])
  @@map("afirmaciones")
}

model Evidencia {
  id               String     @id @default(uuid())
  nombre           String
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  afirmacionId     String     @map("afirmacion_id")
  descripcionCorta String?
  descripcionLarga String?
  imagen           String?
  afirmacion       Afirmacion @relation(fields: [afirmacionId], references: [id], onDelete: Cascade)
  preguntas        Pregunta[]

  @@unique([afirmacionId, nombre])
  @@index([afirmacionId])
  @@map("evidencias")
}

model Pregunta {
  id                 String              @id @default(uuid())
  contexto           String
  imagen             String?
  enunciado          String
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  evidenciaId        String              @map("evidencia_id")
  groupFlag          String?
  opciones           OpcionPregunta[]
  evidencia          Evidencia           @relation(fields: [evidenciaId], references: [id])
  simulacroPreguntas SimulacroPregunta[]
  ejesTematicos      EjeTematico[]       @relation("EjeTematicoPreguntas")

  @@index([evidenciaId])
  @@map("preguntas")
}

model OpcionPregunta {
  id                  String              @id @default(uuid())
  respuesta           String
  correcta            Boolean
  retroalimentacion   String?
  preguntaId          String              @map("pregunta_id")
  pregunta            Pregunta            @relation(fields: [preguntaId], references: [id], onDelete: Cascade)
  respuestasSimulacro SimulacroPregunta[]

  @@index([preguntaId])
  @@map("opciones_pregunta")
}

model Simulacro {
  id              String              @id @default(uuid())
  userId          String              @map("user_id")
  score           Float?
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  competenciaId   String              @map("competencia_id")
  duracionMinutos Int?
  preguntas       SimulacroPregunta[]
  competencia     Competencia         @relation(fields: [competenciaId], references: [id])
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([competenciaId])
  @@map("simulacros")
}

model SimulacroPregunta {
  id                   String          @id @default(uuid())
  simulacroId          String          @map("simulacro_id")
  preguntaId           String          @map("pregunta_id")
  opcionSeleccionadaId String?         @map("opcion_seleccionada_id")
  correcta             Boolean?
  opcionSeleccionada   OpcionPregunta? @relation(fields: [opcionSeleccionadaId], references: [id])
  pregunta             Pregunta        @relation(fields: [preguntaId], references: [id])
  simulacro            Simulacro       @relation(fields: [simulacroId], references: [id], onDelete: Cascade)

  @@unique([simulacroId, preguntaId])
  @@index([simulacroId])
  @@index([preguntaId])
  @@index([opcionSeleccionadaId])
  @@map("simulacro_preguntas")
}

model User {
  id                    String                 @id @default(uuid())
  email                 String                 @unique
  password              String?
  name                  String
  lastName              String?
  image                 String?
  phone                 String?
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  role                  Role                   @default(USER)
  activationDate        DateTime?              @map("activation_date")
  address               String?
  city                  String?
  degree                String?
  department            String?
  idDocument            String?
  isActive              Boolean                @default(false) @map("is_active")
  schoolId              String?                @map("school_id")
  schoolSedeId          String?                @map("school_sede_id")
  lastLogin             DateTime?              @map("last_login")
  emailVerified         DateTime?
  accounts              Account[]
  progresosActividad    ProgresoActividad[]
  progresosSeccion      ProgresoSeccion[]
  progresosSubTema      ProgresoSubTema[]
  sessions              Session[]
  simulacros            Simulacro[]
  testimonios           Testimonio[]
  twoFactorConfirmation TwoFactorConfirmation?
  subscriptions         UserSubscription[]
  school                School?                @relation(fields: [schoolId], references: [id])
  schoolSede            SchoolSede?            @relation(fields: [schoolSedeId], references: [id])

  @@index([schoolId])
  @@index([schoolSedeId])
  @@map("users")
}

model VerificationToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("verification_tokens")
}

model PasswordResetToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("password_reset_tokens")
}

model TwoFactorToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
  @@map("two_factor_tokens")
}

model TwoFactorConfirmation {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("two_factor_confirmations")
}

model Account {
  id                String  @id @default(uuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model School {
  id         String       @id @default(uuid())
  nombre     String
  email      String?      @unique
  DANE       String       @unique
  address    String?
  department String?
  city       String?
  maxUsers   Int?
  sedes      SchoolSede[]
  users      User[]

  @@map("schools")
}

model SchoolSede {
  id       String @id @default(uuid())
  nombre   String
  DANE     String @unique
  schoolId String @map("school_id")
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  users    User[]

  @@index([schoolId])
  @@map("school_sedes")
}

model Testimonio {
  id         String   @id @default(uuid())
  rating     Int
  comentario String
  publicado  Boolean  @default(false)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  userId     String   @map("user_id")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("testimonios")
}

model Plan {
  id             String             @id @default(uuid())
  name           PlanName           @unique
  price          Float
  durationInDays Int                @map("duration_in_days")
  description    String?
  subscriptions  UserSubscription[]

  @@map("planes")
}

model UserSubscription {
  id        String             @id @default(uuid())
  userId    String             @map("user_id")
  planId    String             @map("plan_id")
  startDate DateTime           @map("start_date")
  endDate   DateTime           @map("end_date")
  status    SubscriptionStatus
  payments  Payment[]
  plan      Plan               @relation(fields: [planId], references: [id])
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([planId])
  @@map("user_subscriptions")
}

model Payment {
  id                 String           @id @default(uuid())
  userSubscriptionId String           @map("user_subscription_id")
  amount             Float
  status             PaymentStatus
  paymentGatewayId   String?          @map("payment_gateway_id")
  createdAt          DateTime         @default(now()) @map("created_at")
  userSubscription   UserSubscription @relation(fields: [userSubscriptionId], references: [id], onDelete: Cascade)

  @@index([userSubscriptionId])
  @@map("payments")
}

enum TipoSeccion {
  TEORIA
  INTERACTIVA
}

enum TipoActividadInteractiva {
  RELACIONAR
  IDENTIFICAR
  GRAFICO
}

enum Role {
  ADMIN
  ADMINSCHOOL
  USER
  DOCENTE
}

enum PlanName {
  FREE
  PREMIUM
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum Nivel {
  NIVEL1
  NIVEL2
  NIVEL3
  NIVEL4
}
